<form [formGroup]="commentForm" (ngSubmit)="submitComment()" id="comment-input"
    class="mb-3 border border-1 border-secondary rounded-4">
    <textarea [formControl]="commentFormControl" class="form-control border-0 p-3 rounded-4" placeholder="Add a comment"
        (click)="isCommenting=true"></textarea>
    <div class="d-flex m-2" [class.d-none]="!isCommenting">
        <button type="button" class="btn btn-secondary rounded-pill fw-bold p-2 px-3 ms-auto me-2"
            (click)="isCommenting=false">Cancel</button>
        <button type="submit" class="btn btn-primary rounded-pill fw-bold p-2 px-3"
            [ngClass]="isLoading ? 'btn-secondary' : 'btn-primary'" [disabled]="isLoading">
            Comment
            <div class="spinner-border ms-1" [class.d-none]="!isLoading" style="width: 1em; height: 1em;"></div>
        </button>
    </div>
</form>

<div class="d-flex flex-column" *ngIf="comments$ | async as comments; else loading">
    <div class="d-flex mt-4 gap-2" *ngFor="let comment of comments">
        <img src="https://api.dicebear.com/8.x/avataaars/svg?seed={{comment.user.username}}" alt=""
            routerLink="/user/{{comment.user.username}}"
            class="img-fluid rounded-circle w-100 h-100 bg-secondary-subtle shadow-sm"
            style="aspect-ratio: 1/1; max-height: 3rem; max-width: 3rem; padding: 1px;">
        <div class="d-flex flex-column">
            <a routerLink="/user/{{comment.user.username}}"
                class="fw-semibold text-decoration-none">{{comment.user.displayName}}</a>
            <span class="text-muted small">commented on {{comment.createdAt | date}}</span>
            <p class="mt-3">{{comment.body}}</p>
        </div>
    </div>
</div>

<ng-template #loading>
    <div class="d-flex justify-content-center align-items-center py-5">
        <div class="spinner-border"></div>
    </div>
</ng-template>